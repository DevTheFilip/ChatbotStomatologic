<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>Chat Stomatologic - Doctor & Pacient</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { background: #ebf4fb; font-family: Arial,sans-serif; margin: 0; min-height: 100vh; }
        .chat-container { max-width: 480px; margin: 40px auto; background: #fff; border-radius: 16px; box-shadow: 0 4px 24px #b6d1ea52; padding: 0 0 16px; overflow: hidden; }
        .header { background: #3686d3; color: #fff; padding: 20px 24px; border-bottom: 2px solid #dcf0fb; }
        .header h2 { margin: 0; font-size: 1.3em; }
        .chat-history { padding: 18px 16px 12px 16px; height: 360px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: #f6fbff; }
        .bubble { max-width: 70%; border-radius: 20px; padding: 12px 18px; line-height: 1.3; font-size: 1em; display: inline-block; }
        .doctor { background: #2563eb; color: #fff; align-self: flex-end; border-bottom-right-radius: 4px; margin-left: 15%; margin-right: 0; }
        .patient { background: #e7f3fc; color: #2563eb; border-bottom-left-radius: 4px; align-self: flex-start; margin-right: 15%; margin-left: 0; }
        .meta { font-size: .82em; color: #789; margin-top: 3px; text-align: right; }
        form { display: flex; gap: 8px; padding: 16px; border-top: 1px solid #dcf0fb; }
        input[type=text] { flex: 1; padding: 10px 14px; border: 1px solid #b6d1ea; border-radius: 10px; font-size: 1em; }
        button, .clear-btn { background: #2563eb; color: #fff; border: none; border-radius: 10px; padding: 10px 18px; font-size: 1em; cursor: pointer; transition: 0.15s; }
        .clear-btn { background: #bef264; color: #275c00; margin-left: 8px; }
        form button:hover, .clear-btn:hover { filter: brightness(.94); }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="header">
            <h2>Chat Stomatologic: Doctor & Pacient</h2>
        </div>
        <div class="chat-history" id="chat-history">
            {% for msg in conversation %}
                <div class="bubble {{ msg.sender }}">
                    {{ msg.text }}
                    <div class="meta">{{ msg.sender|capfirst }}</div>
                </div>
            {% empty %}
                <div style="color:#789;">Începe o conversație cu pacientul.</div>
            {% endfor %}
        </div>
        <form method="post" autocomplete="off">
            {% csrf_token %}
            <input type="text" name="message" placeholder="Scrie mesajul tău..." required autofocus autocomplete="off">
            <button type="submit">Trimite</button>
            <a href="{% url 'clear_chat' %}" class="clear-btn">Șterge chat</a>
        </form>
    </div>
    <script>document.getElementById('chat-history').scrollTop = 99999;</script>
</body>
</html>
